# 课件上传功能说明

## 功能概述

课件上传功能允许教师和管理员为课程上传各种格式的课件文件，包括PDF、PPT、Word文档等。系统提供了完整的文件管理功能，包括上传、下载、编辑和删除操作。

## 支持的文件格式

- **PDF文件** (.pdf) - 文档和演示文稿
- **PowerPoint文件** (.ppt, .pptx) - 演示文稿
- **Word文档** (.doc, .docx) - 文档文件
- **文本文件** (.txt) - 纯文本文件

## 文件大小限制

- 最大文件大小：50MB
- 建议文件大小：10MB以下，以确保良好的上传和下载体验

## 功能特性

### 1. 文件上传
- 支持拖拽上传和点击选择文件
- 自动文件类型检测和验证
- 安全的文件名处理（防止路径遍历攻击）
- 唯一文件名生成（避免文件名冲突）
- 上传进度显示

### 2. 文件管理
- 课件列表展示（支持分页）
- 文件类型图标和标签
- 文件大小和上传时间显示
- 课件标题和描述编辑
- 文件排序功能

### 3. 权限控制
- 只有教师和管理员可以上传课件
- 教师只能管理自己课程的课件
- 管理员可以管理所有课程的课件
- 学生可以查看和下载课件

### 4. 文件下载
- 安全的文件下载（验证用户权限）
- 原始文件名保持
- 支持所有上传的文件格式

## API接口说明

### 1. 上传课件
```
POST /api/material/upload
```

**请求参数：**
- `file`: 文件对象（必需）
- `course_id`: 课程ID（必需）
- `title`: 课件标题（必需）
- `description`: 课件描述（可选）

**响应示例：**
```json
{
  "success": true,
  "message": "文件上传成功",
  "material": {
    "id": 1,
    "title": "Python编程基础",
    "content": "课程介绍",
    "material_type": "pdf",
    "file_path": "abc123_document.pdf",
    "course_id": 1,
    "created_at": "2024-01-01T10:00:00",
    "updated_at": "2024-01-01T10:00:00"
  }
}
```

### 2. 获取课件列表
```
GET /api/material/list/{course_id}
```

**查询参数：**
- `page`: 页码（默认1）
- `per_page`: 每页数量（默认20）

**响应示例：**
```json
{
  "materials": [
    {
      "id": 1,
      "title": "Python编程基础",
      "material_type": "pdf",
      "file_path": "abc123_document.pdf",
      "course_id": 1,
      "created_at": "2024-01-01T10:00:00"
    }
  ],
  "total": 1,
  "pages": 1,
  "current_page": 1
}
```

### 3. 下载课件
```
GET /api/material/download/{material_id}
```

**响应：** 文件二进制流

### 4. 更新课件信息
```
PUT /api/material/{material_id}
```

**请求体：**
```json
{
  "title": "更新后的标题",
  "content": "更新后的描述"
}
```

### 5. 删除课件
```
DELETE /api/material/{material_id}
```

## 前端组件

### 1. MaterialUpload.vue
课件上传组件，提供：
- 文件选择和拖拽上传
- 课程选择下拉框
- 文件类型和大小验证
- 上传进度显示
- 错误提示

### 2. MaterialList.vue
课件列表组件，提供：
- 课件列表展示
- 文件类型图标
- 下载、编辑、删除操作
- 分页功能

### 3. MaterialManagementView.vue
课件管理页面，整合：
- 课程选择
- 上传和列表功能
- 编辑模态框

## 数据库设计

### Material表结构
```sql
CREATE TABLE material (
    id INTEGER PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    content TEXT,
    material_type VARCHAR(50) DEFAULT 'text',
    file_path VARCHAR(255),
    external_url VARCHAR(255),
    course_id INTEGER NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    order INTEGER DEFAULT 0,
    FOREIGN KEY (course_id) REFERENCES course(id)
);
```

## 文件存储

### 存储路径
- 基础路径：`backend/uploads/materials/`
- 文件命名：`{uuid}_{原始文件名}`
- 示例：`abc123_document.pdf`

### 安全措施
- 文件名安全处理（防止路径遍历）
- 唯一文件名生成（避免冲突）
- 文件类型验证
- 文件大小限制

## 使用说明

### 教师使用流程
1. 登录系统（教师账户）
2. 进入课件管理页面
3. 选择要上传课件的课程
4. 点击"上传课件"按钮
5. 选择文件并填写标题和描述
6. 点击上传按钮完成上传

### 学生使用流程
1. 登录系统（学生账户）
2. 进入课程详情页面
3. 查看课件列表
4. 点击下载按钮获取课件

## 错误处理

### 常见错误及解决方案

1. **文件类型不支持**
   - 错误：`不支持的文件类型`
   - 解决：确保文件格式为PDF、PPT、Word或TXT

2. **文件过大**
   - 错误：`文件大小不能超过50MB`
   - 解决：压缩文件或选择较小的文件

3. **权限不足**
   - 错误：`需要教师或管理员权限`
   - 解决：使用教师或管理员账户登录

4. **课程不存在**
   - 错误：`课程不存在`
   - 解决：确保选择了正确的课程

## 测试

### 运行测试脚本
```bash
cd backend
python test_material_upload.py
```

### 测试内容
1. 用户登录
2. 获取课程列表
3. 上传测试文件
4. 获取课件列表
5. 下载课件
6. 更新课件信息
7. 删除课件

## 部署注意事项

1. **文件权限**：确保`uploads/materials/`目录有写入权限
2. **磁盘空间**：监控上传目录的磁盘使用情况
3. **备份策略**：定期备份上传的文件
4. **安全配置**：配置适当的文件访问权限

## 未来扩展

1. **文件预览**：支持在线预览PDF和图片文件
2. **版本控制**：支持课件版本管理
3. **批量操作**：支持批量上传和删除
4. **文件压缩**：自动压缩大文件
5. **云存储**：支持云存储服务（如AWS S3） 